<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>RUBus - Accurate Bus Tracking</title>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet-pip@1.1.0/leaflet-pip.js"></script>
    
    <script src='https://unpkg.com/leaflet.marker.slideto@0.2.0/Leaflet.Marker.SlideTo.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/@elfalem/leaflet-curve@0.9.2/dist/leaflet.curve.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/l-subpixel-position@1.0.0/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.x/dist/index.umd.js"></script>
    <script>
        // Simple Analytics fallback system
        // Create a fallback function that prevents errors when SA is blocked
        window.sa_event = function() {
            // Silent fallback - does nothing but prevents "sa_event is not defined" errors
            // This is called when Simple Analytics is blocked by ad blockers
        };
        
        let postLoadEventCalled = false;
        
        function callPostLoadEvent() {
            if (!postLoadEventCalled) {
                postLoadEventCalled = true;
                postLoadEvent();
            }
        }
        
        // Try to load Simple Analytics with proper callback handling
        const saScript = document.createElement('script');
        saScript.async = true;
        saScript.src = 'https://scripts.simpleanalyticscdn.com/latest.js';
        saScript.setAttribute('data-collect-dnt', 'true');
        
        saScript.onload = function() {
            // SA script loaded - check if the function was actually replaced
            // Use a microtask to ensure SA has had time to replace our function
            Promise.resolve().then(function() {
                const isFallback = window.sa_event.toString().includes('Silent fallback');
                if (!isFallback) {
                    console.log('Simple Analytics loaded successfully');
                } else {
                    console.log('Simple Analytics script loaded but function not replaced - likely blocked');
                }
                callPostLoadEvent();
            });
        };
        
        saScript.onerror = function() {
            // SA failed to load (blocked by ad blocker)
            console.log('Simple Analytics blocked or failed to load, using fallback');
            callPostLoadEvent();
        };
        
        // Add the script to the page
        document.head.appendChild(saScript);
    </script>
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v7.0.0/css/all.css"/>

    <link rel="manifest" href="manifest.json">

    <script src="js/error.js"></script>
    <script src="js/vars.js"></script>
    <script src="js/status.js"></script>
    <script defer src="js/leaflet.edgebuffer.js"></script>
    <script defer src="js/map.js"></script>
    <script defer src="js/riding.js"></script>
    <script defer src="js/spoof.js"></script>
    <script defer src="js/poly.js"></script>
    <script src="js/parking.js"></script>
    <script defer src="js/gui.js"></script>
    <script defer src="js/info-panels.js"></script>
    <script defer src="js/ws.js"></script>
    <script defer src="js/rubusws.js"></script>
    <script defer src="js/pre.js"></script>
    <script defer src="js/settings.js"></script>
    <script defer src="js/involved.js"></script>
    <script defer src="js/fav.js"></script>
    <script src="js/share.js"></script>
    <script src="js/ai.js"></script>
    <script defer src="js/all-stops.js"></script>
    <script src="js/feedback.js"></script>
    <script src="js/contact.js"></script>
    <script src="js/campus.js"></script>
    <script src="js/sim.js"></script>
    <script src="js/chat.js"></script>
    <script src="lib/stops.js"></script>
    <script src="lib/routes.js"></script>
    <script src="lib/dist.js"></script>
    <script src="lib/depot.js"></script>
    <script src="lib/stopLines.js"></script>
    <script src="lib/bike_racks.js"></script>
    <script src="lib/building_abbreviations.js"></script>
    <script src="js/buildings.js"></script>
    <script src="js/search.js"></script>
    <script defer src="js/nav.js"></script>
    <script src="js/pathfinding.js"></script>
    <script src="js/icon-helper.js"></script>
    <script src="js/changelog.js"></script>

    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel="stylesheet" type="text/css" href="css/error.css">
    <link rel="stylesheet" type="text/css" href="css/ridership.css">
    <link rel="stylesheet" type="text/css" href="css/tailwind.css">
    <link rel="stylesheet" type="text/css" href="css/mobile.css">
    <link rel="stylesheet" type="text/css" href="css/parking.css">
    <link rel="stylesheet" type="text/css" href="css/modal.css">
    <link rel="stylesheet" type="text/css" href="css/involved.css">
    <link rel="stylesheet" type="text/css" href="css/ai.css">
    <link rel="stylesheet" type="text/css" href="css/all_stops.css">
    <link rel="stylesheet" type="text/css" href="css/pwa.css">
    <link rel="stylesheet" type="text/css" href="css/feedback.css">
    <link rel="stylesheet" type="text/css" href="css/sim.css">
    <link rel="stylesheet" type="text/css" href="css/chat.css">
    <link rel="stylesheet" type="text/css" href="css/search.css">
    <link rel="stylesheet" type="text/css" href="css/search-mobile.css">
    <link rel="stylesheet" type="text/css" href="css/building.css">
    <link rel="stylesheet" type="text/css" href="css/campus-modal.css">
    <link rel="stylesheet" type="text/css" href="css/nav.css">
    <link rel="stylesheet" type="text/css" href="css/icons.css">

    <link rel="icon" type="image/x-icon" href="img/rubus-favicon-autumn.png">
    <link rel="preload" as="image" href="img/stop_marker_selected.png">

    <link href="https://fonts.cdnfonts.com/css/yusei-magic" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/bricolage-grotesque" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/pp-neue-montreal" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/firegrant-stinklez" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/sidecar" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/br-cobane" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js"></script>
        
    <script>
        (function() {
            // Get stored settings, default to auto
            let settings = localStorage.getItem('settings');
            let selectedTheme = 'auto';
      
            if (settings) {
                const parsed = JSON.parse(settings);
                selectedTheme = parsed['theme'] || 'auto';
            }
      
            let computedTheme = selectedTheme;
            if (selectedTheme === 'auto') {
                const currentHour = new Date().getHours();
                computedTheme = (currentHour <= 7 || currentHour >= 18) ? 'dark' : 'light';
            }
      
            document.documentElement.setAttribute('data-selected-theme', selectedTheme);
            document.documentElement.setAttribute('theme', computedTheme);
        })();
    </script>

</head>
<body>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const selectedTheme = document.documentElement.getAttribute('data-selected-theme');
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`[data-theme="${selectedTheme}"]`).classList.add('selected');
        });

        // Preload preview images and critical UI icons
        const preloadImages = [
            'img/theme-select/dark.png',
            'img/theme-select/light.png',
            'img/stop_marker_selected.png'
        ];
        preloadImages.forEach(src => {
            const img = new Image();
            img.src = src;
        });
        
    </script>

    <div class="theme-modal flex flex-col justify-between h-100vh center">
        <div class="theme-header">
            <img class="theme-img" src="img/rubus-favicon-autumn.png" style="width: 20%;">
        </div>
        <div class="theme-body flex flex-col" style="flex:1; overflow:hidden;">
            <div class="theme-controls">
                <div class="text-2p3rem">Pick your preferred theme</div>
                <div class="text-1p7rem" style="color: var(--theme-extra);">You can change this anytime.</div>
                <div class="theme-slider mx-3rem my-2rem">
                    <div class="theme-option" data-theme="light" onclick="selectTheme('light')">Light</div>
                    <div class="theme-option selected" data-theme="auto" onclick="selectTheme('auto')">Auto</div>
                    <div class="theme-option" data-theme="dark" onclick="selectTheme('dark')">Dark</div>
                </div>
            </div>
            <div class="theme-preview">
                <img class="br-1rem w-100" src="img/theme-select/light.png" id="theme-preview-img">
                <script>
                    // Immediately update the preview image before painting
                    (function() {
                        const selectedTheme = document.documentElement.getAttribute('data-selected-theme');
                        const computedTheme = document.documentElement.getAttribute('theme');
                        const previewTheme = (selectedTheme === 'auto') ? computedTheme : selectedTheme;
                        document.getElementById('theme-preview-img').src = `img/theme-select/${previewTheme}.png`;
                    })();
                </script>
            </div>
        </div>
        <div class="flex justify-between align-center">
            <div class="text-1p7rem ml-2rem pointer none ipw" onclick="$('.install-pwa-wrapper').show();">Install App</div>
            <script>
                $(document).ready(function() {
                    if (!window.matchMedia('(display-mode: standalone)').matches) {
                        if (/iPhone/i.test(navigator.userAgent) || /Android/i.test(navigator.userAgent)) {
                            $('.ipw').show();
                        };
                    }
                })     
            </script>
            <div></div>
            <div class="theme-modal-confirm theme-modal-confirm-mobile pointer" onclick="selectTheme('confirm'); continueToCampusModal()">Continue &rarr;</div>
        </div>
    </div>

    <div class="campus-modal none flex-col justify-between h-100vh center">
        <div class="campus-header">Select Your Campus</div>
        <div class="campus-carousel-wrapper flex justify-center align-center" style="flex:1; overflow: visible;">
            <div class="campus-carousel flex align-center" style="overflow-x: auto; scroll-behavior: smooth; width: 100vw;">
                <div class="campus-carousel-item" data-campus="camden">
                    <div class="campus-carousel-label">Camden</div>
                    <img class="campus-carousel-img campus-img-camden" src="img/campus-images/camden-light.png" data-light="img/campus-images/camden-light.png" data-dark="img/campus-images/camden-dark.png">
                </div>
                <div class="campus-carousel-item" data-campus="nb">
                    <div class="campus-carousel-label">New Brunswick</div>
                    <img class="campus-carousel-img campus-img-nb" src="img/campus-images/nb-light.png" data-light="img/campus-images/nb-light.png" data-dark="img/campus-images/nb-dark.png">
                </div>
                <div class="campus-carousel-item" data-campus="newark">
                    <div class="campus-carousel-label">Newark</div>
                    <img class="campus-carousel-img campus-img-newark" src="img/campus-images/newark-light.png" data-light="img/campus-images/newark-light.png" data-dark="img/campus-images/newark-dark.png">
                </div>
            </div>
        </div>
        <div class="campus-modal-confirm campus-modal-confirm-mobile pointer" style="position: fixed; bottom: 1.5rem; right: 1.5rem;" onclick="confirmCampusSelection()">Confirm &rarr;</div>
    </div>
    <script>
        // Hide campus modal by default
        document.querySelector('.campus-modal').style.display = 'none';
        if (JSON.parse(localStorage.getItem('settings')) && JSON.parse(localStorage.getItem('settings'))['theme']) {
            document.querySelector('.theme-modal').style.display = 'none';
            // Only show campus modal if campus is not set
            if (!JSON.parse(localStorage.getItem('settings'))['campus']) {
                document.querySelector('.campus-modal').style.display = 'flex';
            }
        } else if (new URLSearchParams(window.location.search).has('bus')) {
            document.querySelector('.theme-modal').style.display = 'none';
            $(document).ready(async function() {
                if (!localStorage.getItem('settings')) {
                    selectTheme('auto'); // need document ready to wait for this to load
                    setTimeout(() => {
                        updateSettings();
                        settings['theme'] = 'auto'; // idk why this isn't being set in defaultSettings and am too lazy tracing it
                    }, 0);
                }
            })
        }
    </script>


    <div class="info-popup-wrapper h-100">

        <div class="feedback-sent w-fit fixed none">Feedback sent!</div>

        <div class="bus-info-popup">
            <div class="flex flex-col gap-y-0p5rem h-100 ">

                <div class="bus-info-main-wrapper">

                    <div class="bus-info-main">
                        <div class="flex justify-center white text-1p1rem">
                            <div class="info-shared-bus info-shared-bus-mid none">Shared With You</div>
                            <div class="info-riding">Your Bus</div>
                        </div>
                        <div class="flex justify-center white text-1p2rem gap-x-0p5rem">
                            <div class="bus-oos bus-oos-mid br-0p5rem">Out of Service</div>
                            <div class="bus-depot bus-depot-mid br-0p5rem">At Depot</div>
                        </div>
                        <div class="info-main gap-x-0p5rem">
                            <div class="flex align-center gap-x-0p5rem">
                                <div class="info-route info-route-mid"></div>
                                <i class="info-bolt fa-solid fa-bolt none" style="font-size: 2rem;"></i>
                            </div>
                            <div class="info-campuses info-campuses-mid"></div>
                            <div class="info-speed-wrapper">
                                <div class="info-speed info-speed-mid"></div>
                                <div class="info-mph info-mph-mid"></div>
                            </div>
                        </div>
                        <div class="info-extra flex" style="white-space: pre;">
                            <div class="info-name-mid"></div>
                            <div class="info-capacity info-capacity-mid"></div>
                            <div class="info-quickness-mid"></div>
                        </div>
                        <div class="info-overdue-break none mt-0p5rem" style="opacity: 0.7;"></div>
                    </div>
                </div>

                <div class="bus-stopped-for">
                    <div class="flex justify-between">
                        <div class="time">Stopped for Xm</div>
                        <div class="overtime-time"></div>
                        <div class="stop-octagon none"><div class="flex align-center justify-center">!</div></div>
                    </div>
                </div>

                <div class="info-next-stops none">
                    <div class="next-stops-grid none mb-2rem">
                        <div class="grid"></div>
                    </div>

                    <div class="past-breaks-wrapper flex flex-col align-center pt-1rem mb-1rem">
                        <div class="flex flex-col justify-center">
                            <div class="text-1p5rem lightgray center">Past Breaks</div>
                            <div class="bus-avg-break-time text-1p2rem"></div>
                            <div class="bus-avg-break-time-per-hour text-1p2rem"></div>
                        </div>
                        <div class="bus-breaks grid grid-cols-3-auto text-1p4rem gap-x-3rem mt-1rem"></div>
                        <div class="flex justify-evenly w-full">
                            <div class="show-more-breaks text-1p2rem pointer" style="color: #6969bf" onclick="$('.bus-breaks div.long-break').slideDown(); $('.show-more-breaks').hide();">Show All Breaks</div>
                            <div class="show-all-breaks text-1p2rem pointer" style="color: #6969bf" onclick="$('.bus-breaks div').slideDown(); $('.show-all-breaks, .show-more-breaks').hide();">Show All Stops (Slow)</div>
                        </div>
                        <div class="bus-quickness-breakdown-wrapper text-1p2rem none"></div>
                    </div>

                    <div class="mt-3rem bus-ridership-wrapper mb-1rem">
                        <!-- <div class="text-1p5rem lightgray center">Ridership Today</div> -->
                        <div class="bus-historical-capacity mt-0p5rem"></div>
                    </div>

                    <div class="bus-joined-service"></div>

                    <div class="bus-data-extra none"></div>

                </div>

                <div class="bus-info-bottom flex justify-between relative">
                    <div class="bus-info-back-wrapper flex align-center justify-center">
                        <div class="bus-info-back pointer">
                            <i class="fa-solid fa-arrow-left"></i> BACK
                        </div>
                    </div>
                    <div></div> <!-- So star floats right -->
                    <div class="bus-btns flex gap-x-0p5rem">  

                        <!-- <div class="bus-follow br-1rem align-center pointer">
                            <i class="fa-solid fa-map-pin"></i>
                        </div> -->
                        <div class="bus-comment br-1rem align-center pointer">
                            <i class="fa-regular fa-message" onclick="$('.leave-feedback-wrapper').fadeIn('fast'); $('.bottom').hide();"></i>
                        </div>

                        <div class="bus-history br-1rem align-center pointer" onclick="$('.past-breaks-wrapper')[0].scrollIntoView({behavior: 'smooth'});">
                            <i class="fa-solid fa-clock"></i>
                        </div>
                        <script>
                            $('.bus-history, .bus-comment').click(function() {
                                $(this).css('background-color', '#565fe5');
                                setTimeout(() => {
                                    $(this).css('background-color', 'var(--theme-bg)');
                                }, 250);
                            })
                        </script>

                        <div class="bus-share br-1rem align-center none pointer">
                            <i class="fa-solid fa-share-nodes"></i>
                        </div>
                        <script>
                            if (navigator.share) { 
                                $('.bus-share').css('display', 'flex')
                                                .click(function() {
                                                    $(this).css('background-color', '#565fe5');
                                                    setTimeout(() => {
                                                        $(this).css('background-color', 'var(--theme-bg)');
                                                    }, 250);
                                                })
                            }
                            $('.bus-share').click(function() {
                                navigator.share({
                                    title: 'Share This Bus',
                                    text: `${busData[popupBusId].route.toUpperCase()} #${busData[popupBusId].busName}`,
                                    url: 'https://rubus.live/?bus=' + popupBusId,
                                });
                            })
                        </script>
                        <div class="bus-star br-1rem flex align-center pointer">
                            <i class="fa-regular fa-star"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="top-fixed fixed w-full" style="top: 0;">
            <div class="flex flex-col" style="margin: 1rem 2rem;">

                <div class="flex align-center flex-col gap-y-1rem mb-1rem">
                    <div class="dev-build-popup arial none w-fit">ⓘ Developer build</div>
                    <div class="sim-popup arial none w-fit">
                        <div class="flex gap-x-0p5rem align-center">
                            <span>ⓘ Simulating fall buses</span>
                            <span class="sim-exit">EXIT</span>
                            <span class="sim-speed">1x</span>
                        </div>
                    </div>
                </div>
                
                <div class="knight-mover mb-1rem">
                    <div class="center">ⓘ No buses in service</div>
                    <div class="flex justify-center mt-0p5rem mb-0p5rem">
                        <div class="flex gap-x-0p5rem align-center justify-center bg-ckm max-content px-1rem py-0p5rem br-0p5rem" onclick="window.location.href='tel:7329327433'">
                            <i class="fa-solid fa-phone text-1p4rem white"></i>
                            <div class="call white">Call Knight Mover</div>
                        </div>
                    </div>   
                    <div class="text-1p2rem center" style="color: var(--theme-extra)">Knight Mover accepts calls until 5:45AM</div>
                </div>

                <div class="notif-popup"></div>

                <div class="passio-messages mb-1rem">
                    <div class="passio-messages-list flex flex-col gap-y-1rem">
                    </div>
                </div>

                <div class="info-top flex justify-between">
                    <div class="info-top-left flex flex-col gap-y-0p5rem">
                        <div class="knight-mover-mini bg-ckm white align-center gap-x-0p5rem none pointer w-max" onclick="window.location.href='tel:7329327433'"><i class="fa-solid fa-phone text-1p4rem white"></i>Call Knight Mover</div>
                        <div class="shared none gap-x-0p5rem w-max"></div>
                        <div class="favs flex flex-col gap-y-0p5rem w-max"></div>
                    </div>

                    <div class="info-top-right flex flex-col gap-y-1rem align-end">
                        <div class="install-pwa pointer none" onclick="$('.install-pwa-wrapper').show();">Install App ➜</div>
                        <script> 
                        $(document).ready(function(){ if (!isDesktop && 'matchMedia' in window && !new URLSearchParams(window.location.search).has('bus')) {
                            if (!window.matchMedia('(display-mode: standalone)').matches) {
                                $('.install-pwa').show();
                                const iPhoneOrAndroid = /iPhone/i.test(navigator.userAgent) ? 'iphone' : 
                                                       /Android/i.test(navigator.userAgent) ? 'android' : 
                                                       null;
                                if (iPhoneOrAndroid && iPhoneOrAndroid === 'iphone') {
                                    $('.install-pic-1 > img').attr('src', 'img/iphone-pwa-1-arrow.png');
                                    $('.install-pic-2 > img').attr('src', 'img/iphone-pwa-2-arrow.png');
                                    $('.pwa-install-head').text('Install iPhone Web App');
                                    $('.install-pwa-wrapper').show();
                                    
                                    let loadedImages = 0;
                                    $('.install-pic-1 > img, .install-pic-2 > img').on('load', function() {
                                        loadedImages++;
                                        if (loadedImages === 2) {
                                            setTimeout(() => {
                                                const container = $('.install-pwa-wrapper');
                                                const height = container[0].scrollHeight;
                                                container.css('height', height + 'px');
                                            }, 100);
                                        }
                                    });
                                } else if (iPhoneOrAndroid && iPhoneOrAndroid === 'android') {
                                    $('.install-pic-1 > img').attr('src', 'img/android-pwa-1-arrow.png');
                                    $('.install-pic-2 > img').attr('src', 'img/android-pwa-2-arrow.png');
                                    $('.pwa-install-head').text('Install Android Web App');
                                    $('.install-pwa-wrapper').show();
                                    
                                    let loadedImages = 0;
                                    $('.install-pic-1 > img, .install-pic-2 > img').on('load', function() {
                                        loadedImages++;
                                        if (loadedImages === 2) {
                                            setTimeout(() => {
                                                const container = $('.install-pwa-wrapper');
                                                const height = container[0].scrollHeight;
                                                container.css('height', height + 'px');
                                            }, 100);
                                        }
                                    });
                                } else {
                                    $('.install-pwa').hide();
                                }
                            }
                        }}) 
                        </script>
                        <div class="passio-mini flex flex-col gap-y-1rem"></div>
                        <div class="campus-switcher none">
                            <div class="campus-toggle br-1rem">
                                <div class="campus-toggle-btn pointer" data-campus="nb">NB</div>
                                <div class="campus-toggle-btn pointer" data-campus="camden">CAM</div>
                                <div class="campus-toggle-btn pointer" data-campus="newark">NWK</div>
                            </div>
                        </div>
                        
                        <div class="getting-location-popup none">LOCATING...</div>
                        <div class="updating-buses none">UPDATING</div>
                        <div class="slow-connection none">SLOW CONNECTION</div>
                    </div>
                </div>

            </div>
        </div>

        <div class="stop-info-popup">

            <div class="stop-info-popup-inner">
                <div class="flex justify-center">
                    <div class="closest-stop none">CLOSEST STOP</div>
                </div>
                <div class="center"> <!-- style="display: inline-block"-->
                    <span class="stop-name-wrapper">
                        <span class="info-stop-name-text"></span><div class="info-stop-switch none select-none pointer">
                            <div class="flex">
                                <div class="info-stop-switch-1"></div>
                                <div class="info-stop-switch-2"></div>
                            </div>
                        </div>
                    </span>
                </div>
                <div class="info-stop-servicing flex gap-x-1rem justify-center" onclick="$('.stop-info-use-route-selectors-notice').slideDown('fast');"></div>

                <div class="stop-info-use-route-selectors-notice p-1rem br-0p5rem my-0p5rem mx-0 text-1p3rem none">Filter with the route buttons on the bottom of your screen!</div>

                <div class="stop-info-buses-grid align-center"></div>
                <div class="stop-info-next-loop-wrapper none">
                    <div class="stop-info-buses-grid-next align-center"></div>
                </div>
                
                <div class="stop-info-show-next-loop pointer" style="color: #6969bf;" onclick="$('.stop-info-next-loop-wrapper').slideDown(); $('.stop-info-show-next-loop').hide(); $('.always-show-next-loop').show();">Show next loop</div>
                <div class="always-show-next-loop pointer none" style="color: #6969bf; margin-bottom: 0.5rem;" onclick="$('.always-show-next-loop').hide(); settings['toggle-always-show-second'] = true; localStorage.setItem('settings', JSON.stringify(settings)); $('#toggle-always-show-second').prop('checked', true);">Always show next loop</div>
                <div class="stop-info-hide-oos pointer none m-1rem text-1p2rem" style="color:rgb(105, 105, 191); text-align: left; margin-top: 0.5rem !important;" onclick="hideOutOfServiceBuses = true; $('.stop-info-hide-oos').hide(); updateStopBuses(popupStopId, shownRoute);">Hide out of service this session</div>
                <div class="stop-info-avg-wait"></div>
            </div>

            <div class="flex justify-between relative mt-0p5rem">

                <div class="stop-info-back-wrapper flex align-center justify-center">
                    <div class="stop-info-back pointer">
                        <i class="fa-solid fa-arrow-left"></i> BACK
                    </div>
                </div>

                <div class="stop-btns flex gap-x-0p5rem">  
                    <div class="stop-directions br-1rem align-center pointer flex gap-x-0p5rem" onclick="">
                        <i class="fa-solid fa-diamond-turn-right"></i>
                        <div class="bold-500 font-1p7rem">NAV</div>
                    </div>
                    <div class="stop-navigate br-1rem align-center pointer" onclick="navToStop();">
                        <i class="fa-solid fa-person-walking"></i>
                    </div>
                    <script>
                        $('.stop-directions').click(function() {
                            // Check if we have a stop selected - needed?
                            // if (!popupStopId) {
                            //     showNavigationMessage('No stop selected. Please click on a stop first.');
                            //     return;
                            // }

                            // Track stop directions button click
                            sa_event('btn_press', {
                                'btn': 'stop_directions',
                                'stop_name': stopsData[popupStopId].name,
                                'stopId': popupStopId
                            });

                            // Store the stop ID before it gets cleared by hideInfoBoxes
                            const currentStopId = popupStopId;

                            hideInfoBoxes();
                            
                            // Always set the selected stop as the destination
                            setNavigationFromStop(currentStopId, 'to');
                            $('.navigate-wrapper').show();

                            // Focus on the from input for user to enter their starting location
                            $('#nav-from-input').focus();
                        });

                        $('.stop-navigate').click(function() {
                            $(this).css('background-color', '#565fe5');
                            setTimeout(() => {
                                $(this).css('background-color', 'var(--theme-bg)');
                            }, 250);
                        })
                    </script>
                </div>
            </div>
        </div>

        <div class="my-location-popup">

            <div class="flex flex-col align-center">
                <div class="current-location text-2p3rem white you center">You</div>
                <div class="text-1p3rem white stops center">CLOSEST STOPS:</div>

                <div class="closest-stops-list grid text-1p8rem gap-x-3rem mt-0p5rem">

                </div>
            </div>
        </div>

        <div class="building-info-popup none m-1rem w-100 center" style="pointer-events: all; z-index: 403; font-family: var(--font-family); position: relative;">

            <div class="br-1rem p-1rem" style="background-color: var(--theme-bg); color: var(--theme-color);">
                <div class="building-name text-2rem">Hill Center</div>
                <div class="flex justify-center align-center px-1rem mt-1rem">
                    <div class="text-1p4rem mt-0p5rem building-closest-stops-heading">Closest Stops</div>
                    <div class="building-closest-stops-options select-none">
                        <!-- <div class="building-closest-stops-option pointer">Active</div> -->
                        <!-- <div class="building-closest-stops-option pointer">All</div> -->
                    </div>
                </div>
                <div class="building-closest-stops-explain text-1p3rem none mb-1rem left ml-1rem" style="color: var(--theme-extra);">(Selecting a stop or route below will trigger the simulator.)</div>
                <div class="building-closest-stops-list mb-1rem">
                </div>
            </div>

            <div class="flex justify-between relative mt-0p5rem">

                <div class="building-btns flex gap-x-0p5rem">  
                    <div class="building-directions br-1rem align-center pointer flex gap-x-0p5rem" onclick="">
                        <i class="fa-solid fa-diamond-turn-right"></i>
                        <div class="bold-500 font-1p7rem">NAV</div>
                    </div>
                    <div class="building-navigate br-1rem align-center pointer" onclick="">
                        <i class="fa-solid fa-person-walking"></i>
                    </div>
                    <script>
                        $('.building-navigate').click(function() {
                            $(this).css('background-color', '#565fe5');
                            setTimeout(() => {
                                $(this).css('background-color', 'var(--theme-bg)');
                            }, 250);
                            navToBuilding();
                        })
                    </script>
                </div>

            </div>
        </div>
    
        <div class="parking-permit-popup none m-2rem">
            <div class="flex flex-col">
                <div class="parking-day-type flex gap-x-0p5rem text-1p4rem justify-center">
                    <div class="px-1p5rem py-0p5rem br-2rem pointer" data-day-type="weekday">Weekdays</div>
                    <div class="px-1p5rem py-0p5rem br-2rem pointer" data-day-type="weekend">Weekends</div>
                </div>
                <div class="parking-time-scroll-wrapper mt-1p5rem">
                    <div class="parking-time-scroll br-1rem">
                        <div class="time-scroll-container">
                            <div class="time-ticks-container">
                                <!-- Time ticks will be generated here -->
                            </div>
                        </div>
                    </div>
                    <div class="current-time-indicator">
                        <div class="current-time-label"></div>
                        <div class="current-time-tick"></div>
                    </div>
                </div>
                <div class="flex mt-0p5rem">
                    <div class="parking-lot-count text-1p3rem br-1rem py-0p5rem px-1rem bold-500"></div>
                    <div class="parking-lot-list ml-0p5rem select-none"></div>
                </div>
            </div>
        </div>

    </div>

    <div class="bus-log-wrapper none">
        <div class="bus-log grid gap-0p5rem"></div>
        <div class="text-1p2rem pointer mt-0p5rem disable-bus-log-btn select-none" style="color: #6969bf">Disable bus log</div>
    </div>

    <div class="info-panels-show-hide-wrapper none">
        <div class="info-panels-wrapper">
            <div class="info-panels-layout-container">
            <!-- Top row: Subpanels content -->
            <div class="info-panels-content">
                <div class="subpanels-container">
                    <div class="subpanel route-panel">
                        <div class="subpanel-inner">
                            <div id="route-selection-prompt" class="flex h-full justify-center align-center">
                                <div class="text-1p7rem w-half bold-500 center" style="color: var(--theme-color-lighter)">Select a route to view its stops & incoming buses.</div>
                            </div>
                            <div class="route-panel-wrapper">
                                <div class="route-panel none">
                                    <div class="flex flex-col">
                                        <div class="flex align-center gap-x-1rem justify-between">
                                            <div class="flex gap-x-1rem">
                                                <div class="route-name"></div>
                                                <div class="route-campuses flex align-center"></div>
                                            </div>
                                            <div class="color-circle"></div>
                                        </div>  
                                        <div class="route-active-buses center"></div>
                                        <div class="active-buses"></div>
                                        <div class="route-stops-grid"></div>
                                    </div>
                                </div>
                            </div>
                            <!-- Route selectors will be moved here dynamically -->
                            <div id="route-selectors-container"></div>
                        </div>
                    </div>
                    <div class="subpanel all-stops-panel">
                        <div class="subpanel-inner">
                            <div class="all-stops-inner p-1rem mb-8rem"></div>
                        </div>
                    </div>
                    <div class="subpanel buses-panel">
                        <div class="subpanel-inner">
                            <div class="buses-panel-wrapper justify-center">
                                <div class="ridership-title">Network Overview</div>
                                <div class="flex justify-center">
                                    <div class="live-overview">LIVE</div>
                                </div>
                                <div class="buses-overview-grid grid select-none">
                                        <div class="bus-overview-heading">ROUTE</div>
                                        <div class="bus-overview-heading">RIDERSHIP</div>
                                        <div class="bus-overview-heading">LOOP</div>
                                    </div>
                                </div>
                                <div class="ridership-super-wrapper">
                                    <div class="ridership-chart-wrapper">
                                        <!-- <div class="ridership-title">Ridership Today</div> -->
                                        <canvas id="ridership-chart" width="400" height="200"></canvas>
                                    </div>
                                    <div class="ridership-stats-row">
                                        <div class="ridership-avg"></div>
                                        <div class="ridership-max"></div>
                                    </div>
                                    <div class="avg-wait-wrapper">
                                        <div class="avg-wait-title text-1p7rem">Wait Between Buses</div>
                                        <div class="avg-wait-grid grid select-none">
                                            <div class="avg-wait-heading">ROUTE</div>
                                            <div class="avg-wait-heading">AVG WAIT</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bottom row: Header buttons -->
            <div class="info-panels-header-buttons grid gap-x-0p5rem text-1p6rem px-1rem pt-1rem pb-2rem center select-none" style="background-color: var(--theme-bg); border-top: 1px solid var(--theme-border); grid-template-columns: 1fr 1fr 1fr auto;">
                <div class="flex justify-center">
                    <div data-panel="routes" class="flex justify-center align-center gap-x-0p5rem w-min px-1rem py-1rem br-2rem pointer" style="background-color: var(--theme-bg-closest-stop)" onclick="selectInfoPanel('routes', this)">
                        <i class="fa-solid fa-route"></i>
                        <div>Routes</div>
                    </div>
                </div>
                <div class="flex justify-center">
                    <div data-panel="stops" class="flex justify-center align-center gap-x-0p5rem all-stops-selected-menu w-min px-1rem py-1rem br-2rem pointer" style="background-color: var(--theme-bg-closest-stop)" onclick="selectInfoPanel('stops', this)">
                        <i class="fa-solid fa-location-dot"></i>
                        <div>Stops</div>
                    </div>
                </div>
                <div class="flex justify-center">
                    <div data-panel="network" class="flex justify-center align-center gap-x-0p5rem w-min px-1rem py-1rem br-2rem pointer" style="background-color: var(--theme-bg-closest-stop)" onclick="selectInfoPanel('network', this)">
                        <i class="fa-solid fa-bus"></i>
                        <div>Network</div>
                    </div>
                </div>
                <div class="flex info-panels-close justify-center align-center select-none pointer white bold-600">X</div>
            </div>
        </div>
    </div>

    <div class="chat-wrapper none">
      <div class="chat-modal-parent" style="position: fixed; inset: 0; z-index: 403; pointer-events: all;">
        <div class="chat-ui-panel flex flex-col w-100vw h-100vh max-w-100vw max-h-100vh">
          <div class="chat-ui-header flex align-center justify-center relative pb-0p5rem pt-1rem px-1p5rem">
            Chat
            <span class="chat-ui-close flex justify-center align-center select-none absolute">X</span>
          </div>
          <div class="chat-ui-messages flex flex-col gap-1p2rem flex-1 px-1rem">
            <div class="chat-message bot">RUBus Chat is an expert in Rutgers buses capable of answering complex questions about bus routes, schedules, and more. I also have real-time access to the currently running summer buses which you can explicitly ask about.</div>
            <div class="chat-recs flex gap-x-1rem text-1p2rem mt-0p5rem" style="overflow-x: scroll; scrollbar-width: none;"></div>
        </div>
          <form class="chat-ui-input-bar flex align-center gap-0p5rem p-1rem" autocomplete="off">
            <input class="chat-ui-input flex-1" type="text" placeholder="Send a message" />
            <button type="submit" class="chat-ui-send ml-0p5rem" aria-label="Send" title="Send"><i class="fa fa-arrow-up"></i></button>
          </form>
        </div>
      </div>
    </div>

    <div class="navigate-wrapper none">
            <div class="navigate-inner flex flex-col" style="pointer-events: none; z-index: 403; font-family: var(--font-family); position: relative;">
                <div class="navigate-to-from flex flex-col br-1rem" style="background-color: var(--theme-bg); pointer-events: all;">
                    <div class="grid gap-x-1rem gap-y-0p5rem p-1rem align-center" style="grid-template-columns: auto 1fr auto;">
                        <div class="from-circle center">◯</div>
                        <div class="nav-from">
                            <div class="nav-input-wrapper">
                                <input type="text" class="nav-input" id="nav-from-input" placeholder="Start Location" autocomplete="off">
                                <button class="nav-clear-btn" id="nav-from-clear-btn" type="button">×</button>
                            </div>
                            <div class="nav-from-search-results none" style="grid-column: span 3;"></div>
                        </div>
                        <div class="nav-swap text-2rem flex align-center" style="grid-row: span 3;">
                            <i class="fa-solid fa-arrow-right-arrow-left" style="transform: rotate(90deg); display: inline-block;"></i>
                        </div>
                        <div class="center">⋮</div>
                        <div style="height: 1px; background-color: var(--theme-color-lighter);"></div>
                        <div class="center"><i class="fa-solid fa-location-pin"></i></div>
                        <div class="nav-to">
                            <input type="text" class="nav-input" id="nav-to-input" placeholder="Destination" autocomplete="off">
                            <button class="nav-clear-btn" id="nav-to-clear-btn" type="button">×</button>
                        </div>
                        <div class="nav-to-search-results none" style="grid-column: span 3;"></div>
                    </div>
                </div>

                <div class="nav-directions-wrapper none br-1rem">
                    <div class="nav-directions-inner flex flex-col">

                    </div>
                </div>
            </div>
        </div>

    <div class="install-pwa-wrapper none">
        <div class="flex justify-center align-center h-full">
            <div class="install-pwa-iphone flex flex-col gap-y-1rem center align-center">
                <div class="flex flex-col align-center w-full">
                    <div class="text-2p3rem pwa-install-head"></div>
                    <div class="text-1p7rem" style="max-width: 70%; color: var(--theme-extra)">For all features & automatic updates, storage-free.</div>
                </div>
                <div class="grid grid-cols-2 gap-x-2rem m-2rem left text-1p5rem"">
                    <div class="flex flex-col gap-y-0p5rem">
                        <div class="mx-1rem" style="border-bottom: 1px solid gray;">Step 1</div>
                        <div class="install-pic-1">
                            <img>
                        </div>
                    </div>
                    
                    <div class="flex flex-col gap-y-0p5rem">
                        <div class="mx-1rem" style="border-bottom: 1px solid gray;">Step 2</div>
                        <div class="install-pic-2">
                            <img>
                        </div>
                    </div>
                </div>

                <div class="text-1p3rem gray777777 mt-2rem">Or</div>
                <div class="text-1p7rem white br-2rem mt-1rem pointer" style="padding: 0.5rem 1rem; background-color: rgb(89, 89, 205);" onclick="$('.install-pwa-wrapper').hide();">Continue in browser</div>

            </div>
        </div>
        
    </div>

    <div class="leave-feedback-wrapper h-full none">
        <div class="feedback-x flex justify-center align-center" style="top: 2rem; right: 2rem; color: var(--theme-bg); background-color: var(--theme-color)" onclick="$('.leave-feedback-wrapper').hide(); $('.bottom').show();">X</div>
        <div class="leave-feedback-modal h-full"></div>
        <div class="absolute" style="inset: 0;">
            <div class="feedback-outside flex flex-col justify-center align-center h-full left mb-8rem" style="padding: 0 5rem;">
                <div class="w-mn">
                    <div class="text-2p5rem w-full bold-500">Leave feedback</div>
                    <div class="text-1p8rem w-full">About this bus or how RUBus is displaying it.</div>
                    <div class="flex">
                        <textarea class="feedback-input mt-2rem text-1p5rem br-0p5rem p-1rem w-full" placeholder="What's on your mind?"></textarea>
                    </div>
                    <!-- <div class="flex justify-center"> -->
                    <div class="empty-feedback none white br-2rem text-1p4rem w-fit mt-2rem" style="padding: 0.5rem 1.5rem; background-color: #f24160;">You can't submit empty feedback.</div>
                    <div class="white br-2rem text-1p4rem w-fit mt-2rem select-none" style="padding: 0.5rem 1.5rem; background-color: #4f4fd8;" onclick="sendFeedback();">Send Feedback</div>
                    <!-- </div> -->
                </div>
            </div>
        </div>
    </div>

    <div class="search-wrapper none">
        <div>
            <div class="search-input-wrapper">
                <input type="text" placeholder="Search {num} buildings & lots">
                <button class="search-clear-btn" type="button">×</button>
            </div>
            <div class="search-results-wrapper none mt-1rem">
                <div class="search-results">
                </div>
            </div>
            <div class="search-recents-wrapper mt-1rem">
                <div class="flex align-center ml-0p3rem" style="color: var(--theme-color-lighter)">
                    <i class="fa-solid fa-clock-rotate-left" style="font-size: 1.4rem;"></i>
                    <span class="text-1p4rem bold-500 ml-0p5rem">Recent</span>
                </div>
                <div class="search-recents mt-0p5rem flex flex-col gap-y-0p5rem text-1p5rem"></div>
            </div>
            <div class="search-nav-examples-wrapper mt-1p5rem">
                <div class="flex justify-between align-center ml-0p3rem mr-0p3rem">
                    <div class="flex align-center" style="color: var(--theme-color-lighter)">
                        <i class="fa-solid fa-rocket" style="font-size: 1.4rem;"></i>
                        <span class="text-1p4rem bold-500 ml-0p5rem">Navigation examples</span>
                    </div>
                    <button class="search-nav-examples-refresh-btn pointer" type="button" style="background: none; border: none; color: var(--theme-color-lighter); font-size: 1.4rem; padding: 0.25rem; border-radius: 0.25rem;" title="Refresh navigation examples">
                        <i class="fa-solid fa-rotate-right" style="color: var(--theme-hidden-route-col)"></i>
                    </button>
                </div>
                <div class="search-nav-examples mt-0p5rem flex flex-col gap-y-0p5rem text-1p5rem"></div>
            </div>
            <div class="search-recs-wrapper mt-1p5rem">
                <div class="flex justify-between align-center ml-0p3rem mr-0p3rem">
                    <div class="flex align-center" style="color: var(--theme-color-lighter)">
                        <i class="fa-solid fa-fire-flame-curved" style="font-size: 1.4rem;"></i>
                        <span class="text-1p4rem bold-500 ml-0p5rem">Popular places</span>
                    </div>
                    <button class="search-recs-refresh-btn pointer" type="button" style="background: none; border: none; color: var(--theme-color-lighter); font-size: 1.4rem; padding: 0.25rem; border-radius: 0.25rem;" title="Refresh popular places">
                        <i class="fa-solid fa-rotate-right" style="color: var(--theme-hidden-route-col)"></i>
                    </button>
                </div>
                <div class="search-recs mt-0p5rem flex flex-col gap-y-0p5rem text-1p5rem"></div>
            </div>
            <div class="search-surprise-me mt-1p5rem mb-0p5rem">
                <div class="flex align-center ml-0p3rem pointer" style="color: var(--theme-color-lighter);">
                    <i class="fa-solid fa-party-horn" style="font-size: 1.4rem;"></i>
                    <span class="text-1p4rem bold-500 ml-0p5rem">Surprise me</span>
                </div>
            </div>
        </div>
    </div>

    <div class="settings-panel">
        <div class="settings-main-heading center">Settings</div>
        <div class="settings-list flex flex-col">

            <div class="text-1p6rem mb-0p25rem bold-500" style="color: var(--theme-extra)">LOOK & FEEL</div>
            <div class="flex flex-col gap-y-1rem pl-1rem mb-3rem" style="border-left: 2px solid rgb(216 216 216);">
                <div class="settings-font">
                    <div class="settings-heading">Font</div>
                    <div class="settings-options grid grid-cols-3">
                        <div class="settings-option" settings-option="font" font-option="yusei magic" style="font-family: Yusei Magic;">Yusei</div>
                        <div class="settings-option" settings-option="font" font-option="PP Neue Montreal" style="font-family: PP Neue Montreal;">Montreal</div>
                        <div class="settings-option" settings-option="font" font-option="bricolage grotesque" style="font-family: bricolage grotesque;">Grotesque</div>
                        <div class="settings-option" settings-option="font" font-option="dunkin" style="font-family: dunkin; border-top: 1px solid rgb(185, 185, 185); border-left: 0;">Donut</div>
                        <div class="settings-option" settings-option="font" font-option="comic-sans" style="font-family: comic-sans; border-top: 1px solid rgb(185, 185, 185);">Comic Sans</div>
                        <div class="settings-option" settings-option="font" font-option="blockcraft" style="font-family: blockcraft; border-top: 1px solid rgb(185, 185, 185);">Blockcraft</div>
                    </div>
                </div>

                <div class="settings-theme">
                    <div class="settings-heading">Theme</div>
                    <div class="settings-options grid grid-cols-3">
                        <div class="settings-option" settings-option="theme" theme-option="light">Light</div>
                        <div class="settings-option" settings-option="theme" theme-option="dark">Dark</div>
                        <div class="settings-option" settings-option="theme" theme-option="auto">Auto</div>
                    </div>
                    <div class="text-1p3rem dimgray">*Settings menu currently only available in light.</div>
                </div>

                <div class="settings- flex justify-between">
                    <div class="settings-heading flex flex-1 align-center span-i-seconds">Show ETAs in Seconds<span class="span-i pointer select-none">i</span></div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-show-etas-in-seconds" class="toggle-input">
                        <label for="toggle-show-etas-in-seconds" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="seconds-explain none ml-0p5rem text-1p3rem dimgray">Use experimental ETA calculation to forecast in seconds. This may be inaccurate in some edge cases. <br><br>Benchmarks show predictions are within a 20s margin of error 92% of the time.</div>
                <script>
                $('.span-i-seconds').click(function() {$('.seconds-explain').slideToggle();})
                </script>

                <div class="flex justify-between">
                    <div class="settings-heading flex flex-1 align-center span-i-settings-end">Move Settings to End<span class="span-i pointer select-none">i</span></div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-settings-btn-end" class="toggle-input">
                        <label for="toggle-settings-btn-end" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>  
                
                <div class="settings-end-explain none ml-0p5rem text-1p3rem dimgray">Move the settings button to after the route buttons to clear up space in front for more routes and scroll less.</div>
                <script>
                $('.span-i-settings-end').click(function() {$('.settings-end-explain').slideToggle();})
                </script>

                <div class="flex justify-between">
                    <div class="settings-heading">Disable Fireworks on Open</div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-disable-fireworks-on-open" class="toggle-input">
                        <label for="toggle-disable-fireworks-on-open" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="text-1p6rem mb-0p25rem bold-500" style="color: var(--theme-extra)">MAP</div>
            <div class="flex flex-col gap-y-1rem pl-1rem mb-3rem" style="border-left: 2px solid rgb(216 216 216);">

                <div class="flex justify-between">
                    <div class="settings-heading flex flex-1 align-center span-i-focus">Bus Focussing<span class="span-i pointer select-none">i</span></div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-hide-other-routes" class="toggle-input">
                        <label for="toggle-hide-other-routes" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="focus-explain none ml-0p5rem text-1p3rem dimgray">Hide all other buses and center the route when a bus is selected. Drag with two fingers to pan the map. Pan with one finger to restore view.</div>
                <script>
                $('.span-i-focus').click(function() {$('.focus-explain').slideToggle();})
                </script>

                <div class="flex justify-between">
                    <div class="settings-heading flex flex-1 align-center span-i-preload">Preload Map Routes<span class="span-i pointer select-none">i</span></div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-polyline-padding" class="toggle-input">
                        <label for="toggle-polyline-padding" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="text-1p3rem ml-0p5rem none toggle-polyline-padding-unavailable" style="margin-top: -1.5rem; color: #e78080">Option unavailable on iPhone</div>
                <div class="preload-explain none ml-0p5rem text-1p3rem dimgray">Pre-render route lines on the entire map, even outside of view, to avoid having to load them when panning the map. May heavily degrade performance on some devices.</div>
                <script>
                $('.span-i-preload').click(function() {$('.preload-explain').slideToggle();})
                if (/iPhone/i.test(navigator.userAgent)) {
                    $('#toggle-polyline-padding').parent().css('pointer-events', 'none');
                    $('.toggle-polyline-padding-unavailable').show();
                }
                </script>

                <div class="flex justify-between">
                    <div class="settings-heading">Show Stops Above Buses</div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-stops-above-buses" class="toggle-input">
                        <label for="toggle-stops-above-buses" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-marker-size">
                    <div class="settings-heading">Marker Size</div>
                    <div class="settings-options grid grid-cols-3">
                        <div class="settings-option" settings-option="marker-size" marker-size-option="small"><div class="marker small-marker"><div></div></div></div>
                        <div class="settings-option" settings-option="marker-size" marker-size-option="medium"><div class="marker medium-marker"><div></div></div></div>
                        <div class="settings-option" settings-option="marker-size" marker-size-option="big"><div class="marker big-marker"><div></div></div></div>
                    </div>
                </div>

                <div class="flex justify-between">
                    <div class="settings-heading flex flex-1 align-center span-i-spoofing">Location Spoofing<span class="span-i pointer select-none">i</span></div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-spoofing" class="toggle-input">
                        <label for="toggle-spoofing" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-spoofing-explain none ml-0p5rem text-1p3rem dimgray">Allows you to teleport anywhere on the map by tapping; useful for seeing the nearest stops, routes, and buildings to locations you might visit.</div>
                <script>
                $('.span-i-spoofing').click(function() {
                    $('.settings-spoofing-explain').slideToggle();
                });
                </script>
            </div>

            <div class="text-1p6rem mb-0p25rem bold-500" style="color: var(--theme-extra)">STOPS</div>
            <div class="flex flex-col gap-y-1rem pl-1rem mb-3rem" style="border-left: 2px solid rgb(216 216 216);">

                <div class="settings- flex justify-between">
                    <div class="settings-heading flex flex-1 align-center span-i-closest">Select Closest Stop on Open<span class="span-i pointer select-none">i</span></div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-select-closest-stop" class="toggle-input">
                        <label for="toggle-select-closest-stop" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="closest-explain none ml-0p5rem text-1p3rem dimgray">Automatically select your closest stop when you open the app. Requires location permissions; share permanently to avoid the popup on each open.</div>
                <script>
                $('.span-i-closest').click(function() {$('.closest-explain').slideToggle();})
                </script>

                <div class="flex justify-between">
                    <div class="settings-heading flex flex-1 align-center span-i-second">Always Show 2nd Loop<span class="span-i pointer select-none">i</span></div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-always-show-second" class="toggle-input">
                        <label for="toggle-always-show-second" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="text-1p3rem ml-0p5rem none toggle-polyline-padding-unavailable" style="margin-top: -1.5rem; color: #e78080">Option unavailable on iPhone</div>
                <div class="second-explain none ml-0p5rem text-1p3rem dimgray">Display upcoming buses with extended arrival times in stop panels.</div>
                <script>
                $('.span-i-second').click(function() {$('.second-explain').slideToggle();})
                </script>
            </div>

            <!-- <div class="flex justify-between">
                <div class="settings-heading">Hide Simulator</div>
                <div class="settings-toggle">
                    <input type="checkbox" id="toggle-hide-sim" class="toggle-input">
                    <label for="toggle-hide-sim" class="toggle-label">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div> -->

            <!-- <script>
                // Custom handler for Hide Simulator toggle (inverts toggle-show-sim)
                $(function() {
                    // Ensure settings is loaded
                    var settings = localStorage.getItem('settings');
                    if (settings) settings = JSON.parse(settings); else settings = {};
                    // Set initial state
                    $('#toggle-hide-sim').prop('checked', !settings['toggle-show-sim']);
                    // On change, invert toggle-show-sim
                    $('#toggle-hide-sim').on('change', function() {
                        var checked = $(this).is(':checked');
                        settings['toggle-show-sim'] = !checked;
                        localStorage.setItem('settings', JSON.stringify(settings));
                        // UI update: mimic the real Simulator toggle
                        if (!checked) {
                            if (typeof sim !== 'undefined' && typeof selectedCampus !== 'undefined' && !sim && selectedCampus === 'nb') {
                                $('.sim-btn').show();
                            }
                        } else {
                            $('.sim-btn').hide();
                        }
                    });
                });
                </script> -->

            <div class="text-1p6rem mb-0p25rem bold-500" style="color: var(--theme-extra)">EXTRAS</div>
            <div class="flex flex-col gap-y-1rem pl-1rem mb-3rem" style="border-left: 2px solid rgb(216 216 216);">

                <div class="flex justify-between">
                    <div class="settings-heading">Launch Fireworks Button</div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-launch-fireworks-button" class="toggle-input">
                        <label for="toggle-launch-fireworks-button" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="flex justify-between">
                    <div class="settings-heading">Show Bike Racks</div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-show-bike-racks" class="toggle-input">
                        <label for="toggle-show-bike-racks" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-campus">
                    <div class="settings-heading">Campus</div>
                    <div class="settings-options grid grid-cols-3">
                        <div class="settings-option" settings-option="campus" campus-option="nb">NB</div>
                        <div class="settings-option" settings-option="campus" campus-option="camden">Camden</div>
                        <div class="settings-option" settings-option="campus" campus-option="newark">Newark</div>
                    </div>
                    <!-- <div class="ml-0p5rem text-1p3rem dimgray mt-0p5rem">* Camden/Newark campuses will be available in a future update.</div> -->
                </div>

                <div class="flex justify-between">
                    <div class="settings-heading">Campus Switcher</div>
                    <div class="settings-toggle">
                        <input type="checkbox" id="toggle-show-campus-switcher" class="toggle-input">
                        <label for="toggle-show-campus-switcher" class="toggle-label">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="flex justify-between">
                    <div class="settings-heading" style="align-self: center;">Parking Permit</div>
                    <div class="parking-add-container">
                        <div class="parking-add-btn br-2rem bg-black white text-1p6rem pr-1rem py-0p5rem pl-1p5rem flex align-center select-none pointer">
                            <span class="mr-0p5rem">Add</span>
                            <span class="text-1p3rem"><i class="fa-regular fa-plus bold-600"></i></span>
                        </div>
                        <div class="parking-campus-dropdown none">
                            <div class="parking-campus-option" data-campus="Busch">Busch</div>
                            <div class="parking-campus-option" data-campus="Livingston">Livingston</div>
                            <div class="parking-campus-option" data-campus="College Ave">College Ave</div>
                            <div class="parking-campus-option" data-campus="Cook">Cook</div>
                            <div class="parking-campus-option" data-campus="Douglass">Douglass</div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="dev-options-head settings-heading mt-2rem center pointer select-none" onclick="toggleDevOptions()">Show Developer Options ▼</div>
            <div class="dev-options-wrapper none mb-2rem">

                <div class="flex flex-col gap-y-1rem">

                    <div class="settings-map-renderer">
                        <div class="settings-heading">MAP RENDERER</div>
                        <div class="settings-options grid grid-cols-2">
                            <div class="settings-option" settings-option="map-renderer" map-renderer-option="canvas">Canvas</div>
                            <div class="settings-option" settings-option="map-renderer" map-renderer-option="svg">SVG</div>
                        </div>
                    </div>

                    <div class="settings-bus-positioning">
                        <div class="settings-heading">BUS POSITIONING</div>
                        <div class="settings-options grid grid-cols-3">
                            <div class="settings-option" settings-option="bus-positioning" bus-positioning-option="exact">Naive Exact latLng()</div>
                            <div class="settings-option" settings-option="bus-positioning" bus-positioning-option="bezier">Catmull-Rom Cubic Bezier</div>
                            <div class="settings-option" settings-option="bus-positioning" bus-positioning-option="line-string">lineString subPath seg</div>
                        </div>
                    </div>

                    <!-- <div class="settings- flex justify-between">
                        <div class="settings-heading">Show arrival times</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-arrival-times" class="toggle-input">
                            <label for="toggle-show-arrival-times" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>  -->
        
                    <!-- <div class="settings- flex justify-between">
                        <div class="settings-heading">Show bus speeds</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-bus-speeds" class="toggle-input">
                            <label for="toggle-show-bus-speeds" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div> -->

                    <div class="flex justify-between">
                        <div class="settings-heading">Pause updateMarkerPosition()</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-pause-update-marker" class="toggle-input">
                            <label for="toggle-pause-update-marker" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Pause rotation updating</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-pause-rotation-updating" class="toggle-input">
                            <label for="toggle-pause-rotation-updating" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings- flex justify-between">
                        <div class="settings-heading">Whole-pixel positioning</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-whole-pixel-positioning" class="toggle-input">
                            <label for="toggle-whole-pixel-positioning" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings- flex justify-between">
                        <div class="settings-heading">Pause Passio Polling</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-pause-passio-polling" class="toggle-input">
                            <label for="toggle-pause-passio-polling" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings- flex justify-between">
                        <div class="settings-heading">Disconnect from RUBus WSS</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-disconnect-rubus" class="toggle-input">
                            <label for="toggle-disconnect-rubus" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings- flex justify-between">
                        <div class="settings-heading">Show stop polygons</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-stop-polygons" class="toggle-input">
                            <label for="toggle-show-stop-polygons" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings- flex justify-between">
                        <div class="settings-heading">Show dev options by default</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-dev-options" class="toggle-input">
                            <label for="toggle-show-dev-options" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings- flex justify-between">
                        <div class="settings-heading">Show bus IDs</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-bus-id" class="toggle-input">
                            <label for="toggle-show-bus-id" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings- flex justify-between">
                        <div class="settings-heading">Show bus progress to next stop</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-bus-progress" class="toggle-input">
                            <label for="toggle-show-bus-progress" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Show bus overtime timer</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-bus-overtime-timer" class="toggle-input">
                            <label for="toggle-show-bus-overtime-timer" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Show bus path</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-bus-path" class="toggle-input">
                            <label for="toggle-show-bus-path" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Show bus log</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-bus-log" class="toggle-input">
                            <label for="toggle-show-bus-log" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Show extra bus data</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-extra-bus-data" class="toggle-input">
                            <label for="toggle-show-extra-bus-data" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Show stop IDs</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-stop-id" class="toggle-input">
                            <label for="toggle-show-stop-id" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Show call Knight Mover</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-knight-mover" class="toggle-input">
                            <label for="toggle-show-knight-mover" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Show negative ETAs stops grid</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-invalid-etas" class="toggle-input">
                            <label for="toggle-show-invalid-etas" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Show stop rotation points</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-rotation-points" class="toggle-input">
                            <label for="toggle-show-rotation-points" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Allow iPhone Route Preload</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-allow-iphone-preload" class="toggle-input">
                            <label for="toggle-allow-iphone-preload" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Show RUBus AI</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-rubus-ai" class="toggle-input">
                            <label for="toggle-show-rubus-ai" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Breakdown bus quickness</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-bus-quickness-breakdown" class="toggle-input">
                            <label for="toggle-show-bus-quickness-breakdown" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Always immediatelyUpdate</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-always-immediate-update" class="toggle-input">
                            <label for="toggle-always-immediate-update" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Bypass max distance</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-bypass-max-distance" class="toggle-input">
                            <label for="toggle-bypass-max-distance" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- <div class="flex justify-between">
                        <div class="settings-heading">Simulator</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-sim" class="toggle-input">
                            <label for="toggle-show-sim" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div> -->

                    <div class="flex justify-between">
                        <div class="settings-heading">Assistant</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-chat" class="toggle-input">
                            <label for="toggle-show-chat" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Assistant Thinking</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-thinking" class="toggle-input">
                            <label for="toggle-show-thinking" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Show Road Network</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-show-road-network" class="toggle-input">
                            <label for="toggle-show-road-network" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Traveling Seg on Focus</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-distances-line-on-focus" class="toggle-input">
                            <label for="toggle-distances-line-on-focus" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <div class="settings-heading">Exact Break Overdue</div>
                        <div class="settings-toggle">
                            <input type="checkbox" id="toggle-always-show-break-overdue" class="toggle-input">
                            <label for="toggle-always-show-break-overdue" class="toggle-label">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-reset-settings">
                        <div class="settings-heading">REMOVE localStorage.SETTINGS</div>
                        <div class="settings-options grid">
                            <div class="settings-option" onclick="localStorage.removeItem('settings'); $('div.settings-reset-settings div.settings-option').text('Restart for changes to take effect.').css('background-color', 'lightgray')">Reset (restart needed)</div>
                        </div>
                    </div>

                    <div class="settings-reset-location">
                        <div class="settings-heading">REMOVE localStorage.locationShared</div>
                        <div class="settings-options grid">
                            <div class="settings-option" onclick="localStorage.removeItem('locationShared'); $('div.settings-reset-location div.settings-option').text('Restart for changes to take effect.').css('background-color', 'lightgray')">Reset</div>
                        </div>
                    </div>

                    <!-- <div>
                        <div class="settings-heading">fetchWhere() (+updateTimeToStops(validBusIds))</div>
                        <div class="settings-options grid">
                            <div class="settings-option" onclick="fetchWhere()">Execute function</div>
                        </div>
                    </div>

                    <div>
                        <div class="settings-heading">updateTimeToStops([all buses])</div>
                        <div class="settings-options grid">
                            <div class="settings-option" onclick="updateTimeToStops(Object.keys(busData))">Execute function</div>
                        </div>
                    </div> -->

                    </div>

                </div>
            </div>

            <div class="rubus-ai-wrapper none">
                <div class="settings-rubus"></div>
                <div class="rubus-ai" onclick="$('.ai-wrapper').show(); $('.ai-wrapper').scrollTop(0);">
                    <div class="flex justify-center p-0p5rem">
                        <div class="ai-logo"></div>
                    </div>
                    <div class="select-none">
                        <div class="ai-title white bold-500">RUBus AI</div>
                        <div class="white text-1p4rem">Schedule self-learning & automatic notifying. <u>Pre-enroll.</u></div>
                    </div>
                </div>

            </div>

            <div class="settings-rubus mt-2rem">
                <div class="settings-rubus-logo"></div>
                <div class="settings-rubus-attribution">
                    <div>
                        RUBus Beta <span class="build-number"></span><br><br>
                        Not affiliated with Rutgers University or Passio Technologies. Maps by Mapbox, powered by Leaflet. Made with ❤️<br>
                    </div>
                </div>

            </div>

            <div class="settings-rubus-attribution grid grid-cols-3 center select-none gray777777 mt-1p5rem mb-2rem">
                <!-- <div>About</div> -->
                <div class="contact pointer" onclick="contactClicked();">Contact</div>
                <div class="changelog pointer" onclick="getChangelog();">Changelog</div>
                <div class="status pointer" onclick="showStatus();">Status</div>
            </div>

            <div class="settings-rubus-attribution grid grid-cols-4 center select-none gray777777 mt-1p5rem mb-2rem">
                <div class="events-link pointer">Events</div>
                <div class="pointer" onclick="window.open('https://joyousjohn.github.io/ruguessr/', '_blank')">RutgersGuessr</div>
                <div class="source pointer" onclick="window.open('https://src.rubus.live', '_blank')">Source</div>
                <div id="errors-tab" class="errors-tab pointer">
                    <span>Errors</span>
                    <span id="error-count" class="error-count flex justify-center align-center h-full">0</span>
                </div>
            </div>

            <div class="footer flex justify-center mb-10rem flex-col">
                <div class="footer-contact-loading text-1p2rem gray818181 none">Loading contact info...</div>
                <div class="footer-contact-wrapper none">
                    <div class="flex justify-center">
                        <div class="footer-contact grid grid-cols-2-auto text-1p5rem w-max gap-x-1rem gap-y-0p5rem">
                            <div class="footer-contact-email-blurb text-1p3rem italics gray777777 mt-0p5rem mb-1rem center" style="grid-column: span 2; max-width: 90vw;">You may receive a response from a non-@rubus.live email.</div>
                        </div>
                    </div>
                </div>

                <div class="changelog-wrapper none text-1p4rem">
                    <div class="changelog-list"></div>
                </div>

                <div class="status-wrapper none flex justify-around w-full text-1p3rem">
                    <div class="passio-status"></div>
                    <div class="rubus-status"></div>
                </div>

                <div class="errors-wrapper none">
                    <div class="error-panel-header">
                        <div class="error-panel-title">JavaScript Errors (0)</div>
                    </div>
                    <div id="error-list" class="error-list">
                        <div class="error-empty">No errors recorded</div>
                    </div>
                </div>
            </div>

        </div>

        <div class="settings-close none">
            <div class="flex justify-center align-center select-none">X</div>
        </div>

    </div>
    
    <div class="bottom">
        <div class="flex justify-between align-end" style="padding: 0 1rem;">

            <div class="left-btns flex flex-col" style="row-gap: 0.8rem">
                <div class="buildings-btn"><i class="fa-solid fa-building"></i></div>
                <div class="satellite-btn"><i class="fa-solid fa-earth-americas text-2rem"></i></div>
                <!-- <div class="buses-btn none" onclick="busesOverview()"><i class="fa-solid fa-bus"></i></div> -->
                <div class="info-panels-btn-wrapper"><div class="info-panels"><i class="fa-solid fa-location-dot"></i></div></div>
            </div>

            <div class="right-btns flex flex-col" style="row-gap: 0.8rem">
                <div class="chat-btn-wrapper none">
                    <div class="chat-btn"><i class="fa-solid fa-comments"></i></div>
                </div>
                <div class="search-btn-wrapper">
                    <div class="search-btn"><i class="fa-solid fa-search"></i></div>
                </div>
                <div class="launch-fireworks-wrapper none">
                    <div class="shoot-fireworks"><i class="fa-solid fa-bahai"></i></div>
                </div>
                <div class="fly-closest-stop-wrapper none">
                    <div class="fly-closest-stop" onclick="flyToClosestStop()"><i class="fa-solid fa-location-arrow"></i></div>
                </div>
                <div class="centerme-wrapper">
                    <div class="centerme" onclick="centerme()"><i class="fa-solid fa-location-crosshairs"></i></div>
                </div>
                <div class="panout" onclick="panout()"><i class="fa-solid fa-route"></i></div>
            </div>

        </div>
        <div class="flex justify-between">
            <div class="route-selectors">
                <!-- <div class="route-selector sim-btn none">SIM</div> -->
                <div class="route-selector settings-btn"><i class="fa-solid fa-gear"></i></div>
            </div>
        </div>
    </div>

    <div class="color-selection-modal flex-col none">
        <div class="text-2rem flex justify-center align-center p-2rem">Select color for <div class="color-select-route bold-600 text-2p5rem"></div> route</div>
        <div class="color-select-grid grid grid-cols-4 gap-1p5rem px-3rem text-2p5rem white" style="overflow-y: scroll;">
            <div class="color-circle-select color-circle-select-default"></div>
            <div class="color-circle-select" style="background-color: #FF0000;"></div>
            <div class="color-circle-select" style="background-color: #FF2000;"></div>
            <div class="color-circle-select" style="background-color: #FF4000;"></div>
            <div class="color-circle-select" style="background-color: #FF6000;"></div>
            <div class="color-circle-select" style="background-color: #FF8000;"></div>
            <div class="color-circle-select" style="background-color: #FFA000;"></div>
            <div class="color-circle-select" style="background-color: #FFC000;"></div>
            <div class="color-circle-select" style="background-color: #FFE000;"></div>
            <div class="color-circle-select" style="background-color: #FFFF00;"></div>
            <div class="color-circle-select" style="background-color: #C0FF00;"></div>
            <div class="color-circle-select" style="background-color: #80FF00;"></div>
            <div class="color-circle-select" style="background-color: #40FF00;"></div>
            <div class="color-circle-select" style="background-color: #00FF00;"></div>
            <div class="color-circle-select" style="background-color: #00FF40;"></div>
            <div class="color-circle-select" style="background-color: #00FF80;"></div>
            <div class="color-circle-select" style="background-color: #00FFC0;"></div>
            <div class="color-circle-select" style="background-color: #00FFFF;"></div>
            <div class="color-circle-select" style="background-color: #00C0FF;"></div>
            <div class="color-circle-select" style="background-color: #0080FF;"></div>
            <div class="color-circle-select" style="background-color: #0040FF;"></div>
            <div class="color-circle-select" style="background-color: #0000FF;"></div>
            <div class="color-circle-select" style="background-color: #2000FF;"></div>
            <div class="color-circle-select" style="background-color: #4000FF;"></div>
            <div class="color-circle-select" style="background-color: #6000FF;"></div>
            <div class="color-circle-select" style="background-color: #8000FF;"></div>
            <div class="color-circle-select" style="background-color: #A000FF;"></div>
            <div class="color-circle-select" style="background-color: #C000FF;"></div>
            <div class="color-circle-select" style="background-color: #E000FF;"></div>
            <div class="color-circle-select" style="background-color: #FF00FF;"></div>
            <div class="color-circle-select" style="background-color: #FF00C0;"></div>
            <div class="color-circle-select" style="background-color: #FF0080;"></div>
        </div>

        <div class="color-select-btns grid grid-cols-3 gap-x-1rem text-2rem center m-2rem bold-500">
            <div class="color-cancel" style="background-color: #d32828;" onclick="$('.color-selection-modal').css('display', 'none')">Cancel</div>
            <div class="color-reset" style="background-color: #f98d1a;">Reset</div>
            <div class="color-confirm" style="background-color: #34ca34;">Done</div>
        </div>

    </div>

    <div class="involved-wrapper none">
        <div class="involved">
            <div class="involved-grid"></div>
        </div>
        <div class="flex events-close justify-center align-center">X</div>
    </div>

    <div class="ai-wrapper none">

        <div class="fixed p-0p5rem text-1p7rem bold-500 white flex justify-center align-center pointer" style="bottom: 4rem; right: 0.5rem; aspect-ratio: 1; border-radius: 50%; width: 3rem; background-color: purple;" onclick="$('.ai-wrapper').hide();">X</div>

        <div class="flex flex-col gap-y-1rem m-5rem white">

            <div class="flex select-none justify-center">
                <div class="ai-big-logo w-full"></div>
                <div class="flex flex-col">
                    <div class="text-1p3rem ai-exp bold-500"><i class="fa-solid fa-filter mr-0p5rem"></i>Experiment</div>
                    <div class="text-3rem ai-title-big w-fit white br-1rem" style="white-space: pre;">RUBus AI</div>
                </div>
            </div>
            
            <div class="mt-5rem py-2rem px-3rem br-2rem text-1p6rem" style="background: linear-gradient(135deg, #f24160, purple);">Let RUBus learn your travel habits and notify you when it's time to leave.</div>

            <div class="flex flex-col gap-y-0p5rem py-2rem px-3rem br-2rem text-1p5rem" style="background: linear-gradient(135deg, #f24160, purple);">
                <div class="bold-500">Automatically get...</div>
                <div class="flex flex-col ml-1rem">
                    <div>• Notified when to leave for a bus stop to make a class on another campus.</div>
                    <div>• Reminded to leave early on days with increased traffic or bus shortages.</div>
                    <div>• Alerted when an earlier bus could help you avoid delays or overcrowding.</div>
                    <div>• Provided alternative leave times to arrive on time</div>
                </div>
            </div>

            <div class="flex flex-col gap-y-0p5rem py-2rem px-3rem br-2rem text-1p5rem" style="background: linear-gradient(135deg, #f24160, purple);">
                <div class="bold-500">RUBus AI will:</div>
                <div class="flex flex-col ml-1rem">
                    <div>• Find the best bus or combination of buses for your trip</div>
                    <div>• Pick the optimal stops to get on and off</div>
                    <div>• Calculate walking distance and time to your nearest stop</div>
                    <div>• Factor in expected wait times</div>
                    <div>• Ensure you arrive by your target time</div>
                </div>
            </div>

            <div class="bold-500 text-2rem mt-5rem underline center pointer mb-5rem" style="color: #a624ff">Pre-enroll</div>

        </div>
    </div>

    <div id="map">        
        <div id="fireworks"></div>
    </div>

    <noscript><img src="https://queue.simpleanalyticscdn.com/noscript.gif?collect-dnt=true" alt="" referrerpolicy="no-referrer-when-downgrade" /></noscript>

</body>

</html>
